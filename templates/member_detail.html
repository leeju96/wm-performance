<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ member.name }} - 상세 성과</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">
    
    <div class="mb-3">
        <a href="/" class="btn btn-outline-secondary btn-sm">← 메인으로</a>
    </div>

    <h2 class="mb-2">{{ member.name }} 상세 성과</h2>
    <p class="text-muted">{{ member.role }} | {{ member.note }}</p>

    <!-- 팀원 정보 수정 -->
    <div class="card mb-4">
        <div class="card-header">팀원 정보 수정</div>
        <div class="card-body">
            <form method="post" action="/member/{{ member.id }}/update">
                <div class="row g-2">
                    <div class="col-md-4">
                        <label class="form-label">이름</label>
                        <input type="text" name="name" class="form-control" value="{{ member.name }}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">직책 / 역할</label>
                        <input type="text" name="role" class="form-control" value="{{ member.role }}">
                    </div>
                    <div class="col-12 mt-2">
                        <label class="form-label">메모</label>
                        <textarea name="note" class="form-control" rows="2">{{ member.note }}</textarea>
                    </div>
                </div>

                <div class="mt-3">
                    <button class="btn btn-primary" type="submit">정보 수정</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 팀원 삭제 (독립 폼) -->
    <div class="mb-4">
        <form method="post"
              action="/member/{{ member.id }}/delete"
              onsubmit="return confirm('정말 이 팀원과 모든 성과 기록을 삭제할까?');">
            <button class="btn btn-outline-danger">팀원 삭제</button>
        </form>
    </div>

    <!-- 기간 검색 -->
    <form method="get" class="row g-2 mb-4">
        <div class="col-auto">
            <label class="col-form-label">기간 검색</label>
        </div>
        <div class="col-auto">
            <input type="date" name="start_date" class="form-control" value="{{ start_date_value }}">
        </div>
        <div class="col-auto">
            <span class="col-form-label">~</span>
        </div>
        <div class="col-auto">
            <input type="date" name="end_date" class="form-control" value="{{ end_date_value }}">
        </div>
        <div class="col-auto">
            <button class="btn btn-outline-success" type="submit">적용</button>
        </div>
        <div class="col-auto">
            <button class="btn btn-outline-secondary" type="submit"
                    onclick="this.form.start_date.value=''; this.form.end_date.value='';">
                초기화
            </button>
        </div>
    </form>

    <!-- 그래프 -->
    <div class="card mb-4">
        <div class="card-header">개인 그래프</div>
        <div class="card-body">
            <canvas id="amountChart" height="120" class="mb-4"></canvas>
            <canvas id="countChart" height="120"></canvas>
        </div>
    </div>

    <!-- 기록 테이블 -->
    <div class="card">
        <div class="card-header">{{ member.name }}의 기록</div>
        <div class="card-body p-0">
            <table class="table table-striped mb-0">
                <thead class="table-light">
                    <tr>
                        <th>날짜</th>
                        <th class="text-end">금액</th>
                        <th class="text-end">건수</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr>
                        <td>{{ log.log_date.strftime('%Y-%m-%d') }}</td>
                        <td class="text-end">{{ "{:,}".format(log.sponsor_amount) }}</td>
                        <td class="text-end">{{ log.count }}</td>
                    </tr>
                    {% endfor %}
                    {% if logs|length == 0 %}
                    <tr>
                        <td colspan="3" class="text-center text-muted py-3">기록이 없습니다.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<script>
    const labels = {{ chart_labels | tojson }};
    const amounts = {{ chart_amounts | tojson }};
    const counts = {{ chart_counts | tojson }};

    if (labels.length > 0) {
        new Chart(document.getElementById('amountChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '금액',
                    data: amounts,
                    borderWidth: 2
                }]
            }
        });

        new Chart(document.getElementById('countChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '건수',
                    data: counts,
                    borderWidth: 2
                }]
            }
        });
    }
</script>

</body>
</html>

